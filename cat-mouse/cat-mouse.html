<!DOCTYPE html>
<html>
<head>
  <title>Cat and Mouse Chase</title>
</head>
<body>
<div id="game">
  <p>Distance: <span id="distance"></span></p>
  <p>Cat Steps: <span id="catSteps"></span></p>
  <p>Mouse Steps: <span id="mouseSteps"></span></p>
  <div id="messages"></div>
</div>

<script>
  const conn = new WebSocket('ws://localhost:8080');
  const distanceDisplay = document.getElementById('distance');
  const catStepsDisplay = document.getElementById('catSteps');
  const mouseStepsDisplay = document.getElementById('mouseSteps');
  const messages = document.getElementById('messages');

  let receivedData = []; // Array to store received data

  conn.onopen = function(e) {
    console.log("Connection established!");
  };

  conn.onmessage = function(e) {
    const data = JSON.parse(e.data);
    if (data.distance !== undefined) {
      receivedData.push(data); // Store data in the array
    }
    if (data.message !== undefined) {
      const newMessage = document.createElement('p');
      newMessage.textContent = data.message;
      messages.appendChild(newMessage);
    }
    console.log(data);
  };

  // Function to process the received data with a delay
  function processData() {
    let index = 0;
    const interval = setInterval(() => {
      if (index < receivedData.length) {
        updateDisplay(receivedData[index]);
        index++;
      } else {
        clearInterval(interval); // Stop the interval when all data is processed
      }
    }, 500); // 500 milliseconds (0.5 seconds)
  }

  function updateDisplay(data) {
    distanceDisplay.textContent = data.distance;
    catStepsDisplay.textContent = data.catSteps;
    mouseStepsDisplay.textContent = data.mouseSteps;
  }

  conn.onclose = function(e) {
    processData();
  }

  // If you want to process the data after a delay, instead of on close, use this.
  // setTimeout(processData, 3000);

</script>
</body>
</html>